---
status: open
priority: high
created: 2026-02-05
---
# TKT-020: Introduce employer entity to support bureau and group models

## Summary

Currently all HR data (employees, salaries, payruns, etc.) is scoped directly to `orgId`. To support both the bureau model (accounting firm managing multiple clients) and the group model (holding company with subsidiaries), we need to introduce an `employer` entity with a delegation/sharing layer that allows employers to be accessed across org boundaries.

## Motivation

- **Bureau model**: An accounting firm ("Smith & Co") needs one org but manages payroll for multiple unrelated clients
- **Group model**: A holding company ("Acme Group") has multiple subsidiaries each running their own payroll
- **Cross-org access**: An employer entity may need to be accessible from both the owning org (the group) and an external org (the accounting firm managing it)
- The productivity app (tisket/client) and the HR app have fundamentally different org semantics — this decouples them

## Proposed Model

### Employer as a standalone entity with delegation

The employer has an owner org but can be shared with other orgs via access grants — similar to how QuickBooks Online Accountant lets firms access client companies without being inside the client's org.

```
"Acme Group" org (the group)
  ├── Employer: "Acme UK"       ← owned, managed internally
  ├── Employer: "Acme Germany"  ← owned, managed internally
  └── Employer: "Acme US"       ← owned, delegated to Smith & Co

"Smith & Co" org (the accounting firm)
  ├── Employer: "Acme US"       ← shared from Acme Group
  └── Employer: "Jane's Gym"    ← owned, their own client
```

### Schema

```
employer
  ├── id
  ├── ownerOrgId     ← the org that owns this employer
  ├── name
  └── ...legal entity details

employer_access
  ├── employerId
  ├── orgId           ← which org is accessing it
  ├── userId
  └── role            ← admin / preparer / viewer
```

- **Org membership** (WorkOS): controls who can log in
- **Employer access** (app-level): controls which employers a user can see/manage, and through which org
- For the simple 1:1 case (one company, not a bureau or group), a single employer is auto-created and auto-selected — no extra steps

### Precedent

This mirrors the QuickBooks model where each client company is a separate entity, the accounting firm has a cross-client dashboard, and team members are assigned to specific clients. The difference is we don't require a separate subscription per employer — the employer entity lives within the same system with access controlled via delegation.

## MCP API Considerations

The MCP API currently scopes operations via `orgId` in the session context. With the employer entity:

- Add `employer` to the MCP session context — follows the same pattern as workspace/project/team selection via the `context` tool
- All existing MCP tool signatures remain unchanged; `employerId` is resolved from session context rather than passed per-call
- For the 1:1 case (org has a single employer), auto-select it so the MCP consumer doesn't need an extra step
- Only require explicit employer selection when the org has multiple employers
- List available employers in the context tool output so callers know what's available to switch to

## Key Tasks

- [ ] Add `employer` table (id, ownerOrgId, name, legal entity details, etc.)
- [ ] Add `employer_access` table (employerId, orgId, userId, role)
- [ ] Build delegation flow — owner org can share an employer with another org
- [ ] Migrate existing data: create a default employer per org, re-scope all HR data from `orgId` to `employerId`
- [ ] Update all HR queries/routers to scope by `employerId` instead of `orgId`
- [ ] Update MCP API to resolve `employerId` from session context, auto-select for 1:1 orgs
- [ ] Add employer switcher UI within an org context
- [ ] Add cross-employer dashboard view (aggregates across all employers the user has access to)
- [ ] Ensure the simple 1:1 case feels seamless (no extra switching or setup required)
